{"version":3,"sources":["pictures-test.js"],"names":["beforeEach","t","srv","context","url","image","getImage","body","uri","publicId","json","deepEqual","options","method","description","src","userId","resolveWithFullResponse","result","throws","token","signToken","secret","headers","response","is","statusCode","id","imageNew","JSON","parse","stringify","liked","likes","images","getImages","getImagesByTag"],"mappings":"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","file":"pictures-test.js","sourcesContent":["'use strict'\n\nimport test from 'ava'\nimport micro from 'micro'\nimport listen from 'test-listen'\nimport request from 'request-promise'\nimport pictures from '../pictures'\nimport fixtures from './fixtures'\nimport utils from '../lib/utils'\nimport config from '../config'\n\n// ESTE TEST SE EJECUTA PRIMERO QUE TODOS LOS DEMAS Y SE ENCARGA DE:\n// LEVANTAR EL SERVICIO\ntest.beforeEach(async t => {\n  let srv = micro(pictures)\n  t.context.url = await listen(srv)\n})\n\n// ESTE TEST SIRVE PARA PROBAR LA FUNCIONALIDAD DE:\n// EL ENDPOINT GET DE LAS PICTURES\ntest('GET /:id', async t => {\n  let image = fixtures.getImage()\n  let url = t.context.url\n\n  let body = await request({ uri: `${url}/${image.publicId}`, json: true })\n  t.deepEqual(body, image)\n})\n\n// ESTE TEST SIRVE PARA PROBAR LA FUNCIONALIDA DE:\n// EL ENDPOINT POST DE LAS PICTURES PARA UN TOKEN INVALIDO\ntest('no token POST /', async t => {\n  let image = fixtures.getImage()\n  let url = t.context.url\n\n  let options = {\n    method: 'POST',\n    uri: url,\n    json: true,\n    body: {\n      description: image.description,\n      src: image.src,\n      userId: image.userId\n    },\n    resolveWithFullResponse: true\n  }\n\n  let result = await request(options)\n\n  t.throws(result, /invalid token/)\n})\n\n// ESTE TEST SIRVE PARA PROBAR LA FUNCIONALIDA DE:\n// PARA UN TOKEN VALIDO\ntest('secure token POST /', async t => {\n  let image = fixtures.getImage()\n  let url = t.context.url\n  let token = await utils.signToken({ userId: image.userId }, config.secret)\n\n  let options = {\n    method: 'POST',\n    uri: url,\n    json: true,\n    body: {\n      description: image.description,\n      src: image.src,\n      userId: image.userId\n    },\n    headers: {\n      'Autorization': `Bearer ${token}`\n    },\n    resolveWithFullResponse: true\n  }\n\n  let response = await request(options)\n  t.is(response.statusCode, 201)\n  t.deepEqual(response.body, image)\n})\n\n// ESTE TEST SIRVE PARA PROBAR LA FUNCIONALIDAD DE:\n// EL ENDPOINT POST PARA DAR LIKE\ntest('POST /:id/like', async t => {\n  let image = fixtures.getImage()\n  let url = t.context.url\n\n  let options = {\n    method: 'POST',\n    uri: `${url}/${image.id}/like`,\n    json: true\n  }\n\n  let body = await request(options)\n  let imageNew = JSON.parse(JSON.stringify(image))\n  imageNew.liked = true\n  imageNew.likes = 1\n\n  t.deepEqual(body, imageNew)\n})\n\n// ESTE TEST SIRVE PARA PROBAR LA FUNCIONALIDAD DE:\n// EL ENDPOINT GET PARA OBTENER LA LISTA DE PICTURES\ntest('GET /list', async t => {\n  let images = fixtures.getImages()\n  let url = t.context.url\n\n  let options = {\n    method: 'GET',\n    uri: `${url}/list`,\n    json: true\n  }\n\n  let body = await request(options)\n  t.deepEqual(body, images)\n})\n\n// ESTE TEST SIRVE PARA PROBAR LA FUNCIONALIDAD DE:\n// EL ENDPOINT GET PARA OBTENER LA LISTA DE PICTURES POR TAG\ntest('GET /tag/:tag', async t => {\n  let images = fixtures.getImagesByTag()\n  let url = t.context.url\n\n  let options = {\n    method: 'GET',\n    uri: `${url}/tag/awesome`,\n    json: true\n  }\n\n  let body = await request(options)\n  t.deepEqual(body, images)\n})\n"]}